## 概要
FUSE(Filesystem in Userspace)を利用し、自前のファイルシステムを作成します。今回はRedisを用いてファイルシステムを構築する。機能としてはファイルを作成と削除、書き込みと読み込みをできるようにする。ディレクトリの作成などは機能に含まれてません。

## 設計
ファイルシステムの設計は、redisのgetとsetコマンドを使用し、keyの値をファイル名、valueの値をファイルの中身とする。

FUSEを利用するために幾つかのコールバック関数を用意しなければいけないが、今回実装したコールバック関数についての説明は下記に記述する。

1. getattr(self, path, fh=None)  
目的: 指定されたパスのファイルまたはディレクトリの属性を取得します。  
返り値: ファイルの属性を含む辞書。例としてst_mode（ファイルモード）、st_size（ファイルサイズ）などを返す必要があります。  
FUSEが呼び出すタイミング: ファイルやディレクトリの属性情報が必要な場合（例: lsコマンドの実行時）。  
2. readdir(self, path, fh)  
目的: ディレクトリの中身（ファイルやサブディレクトリ）をリストとして返します。  
返り値: ディレクトリに含まれるファイル名のリスト（['.', '..', 'file1', 'file2']のように返す）。  
FUSEが呼び出すタイミング: ディレクトリの内容を取得する場合（例: lsコマンド）。  
3. read(self, path, size, offset, fh)  
目的: 指定されたファイルの内容を読み取ります。  
引数:
path: ファイルのパス。
size: 読み取るサイズ（バイト数）。
offset: 読み取るデータの開始位置。  
返り値: 指定された位置からsizeバイトのデータを返します。  
FUSEが呼び出すタイミング: ファイルの内容が必要なとき（例: catコマンド）。  
4. write(self, path, data, offset, fh)  
目的: 指定されたファイルにデータを書き込みます。  
引数:
path: ファイルのパス。
data: 書き込むデータ。
offset: 書き込みを開始するファイル内の位置。  
返り値: 書き込まれたバイト数。
FUSEが呼び出すタイミング: ファイルにデータを書き込む際（例: echo "data" > file）。
5. create(self, path, mode)  
目的: 新しいファイルを作成します。  
引数:
path: 作成するファイルのパス。
mode: ファイルのパーミッション（st_mode）。  
返り値: ファイルハンドルを返す必要がある場合もありますが、ここでは0で良い。  
FUSEが呼び出すタイミング: 新しいファイルを作成するとき（例: touch file）。  
6. unlink(self, path)  
目的: 指定されたファイルを削除します。  
引数:
path: 削除するファイルのパス。  
FUSEが呼び出すタイミング: ファイルが削除されるとき（例: rm file）。  
7. open(self, path, flags)  
目的: ファイルを開く処理を行います。  
引数:
path: 開こうとしているファイルのパス。
flags: ファイルのオープンモード。  
返り値: ファイルを正常に開いたかどうかを示す値。通常0を返す。  
FUSEが呼び出すタイミング: ファイルが開かれたとき（例: cat file）。  

## ソースコード
ソースはこの[リポジトリ](https://github.com/Kei-Ta/fuse-redis)にあります。

## 起動方法
ワーキングディレクトリはpyに移動する。
``` sh
cd py
```

### 1. コンテナをビルドする
``` sh
 docker build -t redis-fuse .  
```
### 2. コンテナを起動する
``` sh
 docker run --privileged -it --rm --name fuse redis-fuse
```

## 動作確認
### 1. コンテナの中に入る
``` sh
 docker exec -it fuse /bin/bash
```

### 2. マウント先に移動する
``` sh
 cd /mnt/redis
```

### 3. ファイルの作成、削除
``` sh
 touch a.txt
```
lsコマンドを実行するとファイルが作成されていることがわかる。
``` sh
 a.txt
```
redisに入って確認してみる。
``` sh
 redis-cli
```
キーを取得すると作成したファイルのキーが存在していることがわかる。
``` sh
 keys *
 1) "a.txt"
```
次にファイルを削除する。
``` sh
 rm a.txt
```
lsコマンドを実行するとファイルが消えていることがわかる。
``` sh
 ls
```
redisからもキーが削除されていることを確認する。
```
 redis-cli
 keys a.txt
 (empty array)
```

### 4. ファイルに書き込み、読み込み
``` sh
 echo "hello world" > b.txt
```
catコマンドを実行するとファイルに値が書き込まれてることがわかる。
``` sh
 cat b.txt
 hello world
```